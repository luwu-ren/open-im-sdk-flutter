# 群组字段说明文档

本文档详细说明了群组（Group）模型中的所有字段，包括基础字段和新增字段。

## 目录

- [基础字段](#基础字段)
- [地理位置相关字段](#地理位置相关字段)
- [群组设置字段](#群组设置字段)
- [行政区域字段](#行政区域字段)
- [标签字段](#标签字段)
- [API 接口](#api-接口)
- [数据返回示例](#数据返回示例)
- [注意事项](#注意事项)

---

## 基础字段

### GroupID

- **类型**: `String`
- **说明**: 群组唯一标识符
- **必填**: 是
- **示例**: `"group_123456789"`

### GroupName

- **类型**: `String?`
- **说明**: 群组名称
- **必填**: 是（创建群组时）
- **示例**: `"技术交流群"`

### Notification

- **类型**: `String?`
- **说明**: 群公告内容
- **必填**: 否
- **示例**: `"欢迎加入本群，请遵守群规"`

### Introduction

- **类型**: `String?`
- **说明**: 群组简介/介绍
- **必填**: 否
- **示例**: `"这是一个技术交流群，欢迎大家分享技术经验"`

### FaceURL

- **类型**: `String?`
- **说明**: 群组头像URL
- **必填**: 否
- **示例**: `"https://example.com/avatar.jpg"`

### CreateTime

- **类型**: `int?` (毫秒时间戳)
- **说明**: 群组创建时间
- **必填**: 自动生成
- **示例**: `1704067200000`

### Ex

- **类型**: `String?`
- **说明**: 扩展字段，用于存储自定义信息（JSON格式）
- **必填**: 否
- **示例**: `"{\"custom_field\":\"value\"}"`

### Status

- **类型**: `int?`
- **说明**: 群组状态
- **必填**: 是
- **取值**:
  - `0`: 正常
  - `1`: 已解散
- **示例**: `0`

### CreatorUserID

- **类型**: `String?`
- **说明**: 创建者用户ID
- **必填**: 是
- **示例**: `"user_123456"`

### GroupType

- **类型**: `int?`
- **说明**: 群组类型
- **必填**: 是
- **取值**: 目前仅支持工作群（WorkingGroup = 2）
- **示例**: `2`

### NeedVerification

- **类型**: `int?`
- **说明**: 是否需要验证（申请入群需要审核）
- **必填**: 是
- **取值**:
  - `0`: 不需要验证（可直接加入）
  - `1`: 需要验证（需要审核）
- **示例**: `1`

### LookMemberInfo

- **类型**: `int?`
- **说明**: 是否允许查看成员信息
- **必填**: 是
- **取值**:
  - `0`: 不允许
  - `1`: 允许
- **示例**: `1`

### ApplyMemberFriend

- **类型**: `int?`
- **说明**: 是否允许申请加好友
- **必填**: 是
- **取值**:
  - `0`: 不允许
  - `1`: 允许
- **示例**: `1`

### NotificationUpdateTime

- **类型**: `int?` (毫秒时间戳)
- **说明**: 群公告最后更新时间
- **必填**: 否
- **示例**: `1704153600000`

### NotificationUserID

- **类型**: `String?`
- **说明**: 最后更新群公告的用户ID
- **必填**: 否
- **示例**: `"user_123456"`

### OwnerUserID

- **类型**: `String?`
- **说明**: 群主用户ID
- **必填**: 否
- **示例**: `"user_123456"`

### MemberCount

- **类型**: `int?`
- **说明**: 群成员数量
- **必填**: 否
- **示例**: `150`

---

## 地理位置相关字段

### Location

- **类型**: `String?` (JSON格式字符串)
- **说明**: 群组地理位置（GeoJSON格式），用于地理检索
- **必填**: 否
- **格式**: GeoJSON Point 格式
  ```json
  {
    "type": "Point",
    "coordinates": [longitude, latitude]
  }
  ```
- **注意**:
  - 经度在前，纬度在后（符合GeoJSON标准）
  - 经度范围: -180 到 180
  - 纬度范围: -90 到 90
- **示例**:
  ```json
  {
    "type": "Point",
    "coordinates": [116.397128, 39.916527]
  }
  ```
- **用途**:
  - 支持地理检索（附近群组查询）
  - 支持范围查询（指定区域内的群组）
  - MongoDB 2dsphere 索引支持

### Latitude

- **类型**: `double?`
- **说明**: 群组地理位置-纬度（冗余字段，便于查询和显示）
- **必填**: 否（与 Longitude 一起使用）
- **范围**: -90.0 到 90.0
- **示例**: `39.916527`
- **用途**:
  - 快速查询和排序
  - 前端显示
  - 与 Longitude 配合使用

### Longitude

- **类型**: `double?`
- **说明**: 群组地理位置-经度（冗余字段，便于查询和显示）
- **必填**: 否（与 Latitude 一起使用）
- **范围**: -180.0 到 180.0
- **示例**: `116.397128`
- **用途**:
  - 快速查询和排序
  - 前端显示
  - 与 Latitude 配合使用

### LocationAddress

- **类型**: `String?`
- **说明**: 群组地理位置-地址描述（可读的地址文本）
- **必填**: 否
- **示例**: `"北京市东城区天安门广场1号"`
- **用途**:
  - 用户友好的地址显示
  - 搜索和筛选
  - 与经纬度配合使用

---

## 群组设置字段

### Settings

- **类型**: `String?` (JSON格式字符串)
- **说明**: 群组设置，JSON格式存储自定义配置项
- **必填**: 否
- **格式**: JSON 字符串
- **示例**:
  ```json
  {
    "allow_member_invite": true,
    "mute_all": false,
    "auto_approve": false,
    "welcome_message": "欢迎加入群组",
    "custom_settings": {
      "theme": "dark",
      "notification_sound": "default"
    }
  }
  ```
- **用途**:
  - 存储群组自定义配置
  - 支持灵活的扩展需求
  - 可根据业务需求自定义字段

### IsPublic

- **类型**: `int?`
- **说明**: 是否公开群（可被搜索加入）
- **必填**: 是
- **取值**:
  - `0`: 不公开（私密群，只能通过邀请加入）
  - `1`: 公开（可被搜索到并申请加入）
- **默认值**: `0`（不公开）
- **示例**: `1`
- **用途**:
  - 控制群组的可见性
  - 支持公开群组搜索功能
  - 区分私密群和公开群

### MaxMemberCount

- **类型**: `int?`
- **说明**: 群成员数量限制
- **必填**: 是
- **取值**:
  - `0`: 无限制
  - `> 0`: 最大成员数
- **默认值**: `200`（新建群组时自动设置）
- **示例**: `500`
- **用途**:
  - 控制群组规模
  - 防止群组过大影响性能
  - 支持不同规模的群组需求

---

## 行政区域字段

### Country

- **类型**: `String?`
- **说明**: 行政区域-国家（ISO 3166-1 alpha-2 国家代码）
- **必填**: 否
- **格式**: ISO 3166-1 alpha-2 标准（2位字母代码）
- **示例**:
  - `"CN"` - 中国
  - `"US"` - 美国
  - `"GB"` - 英国
  - `"JP"` - 日本
- **用途**:
  - 按国家筛选群组
  - 国际化支持
  - 与 City、District 配合使用

### City

- **类型**: `String?`
- **说明**: 行政区域-城市
- **必填**: 否
- **示例**:
  - `"北京"`
  - `"上海"`
  - `"New York"`
- **用途**:
  - 按城市筛选群组
  - 本地化服务
  - 与 Country、District 配合使用

### District

- **类型**: `String?`
- **说明**: 行政区域-区/县/行政区
- **必填**: 否
- **示例**:
  - `"东城区"`
  - `"黄浦区"`
  - `"Manhattan"`
- **用途**:
  - 按区县筛选群组
  - 精确的地理定位
  - 与 Country、City 配合使用

### AdministrativeRegion

- **类型**: `String?` (JSON格式字符串)
- **说明**: 完整行政区域信息（JSON格式），包含国家、城市、区等完整层级信息，便于扩展
- **必填**: 否
- **格式**: JSON 对象
- **示例**:
  ```json
  {
    "country": "CN",
    "country_name": "中国",
    "province": "北京市",
    "city": "北京市",
    "district": "东城区",
    "street": "天安门广场",
    "postal_code": "100006",
    "full_address": "中国北京市东城区天安门广场"
  }
  ```
- **用途**:
  - 存储完整的行政区域层级信息
  - 支持多级行政区域查询
  - 便于扩展更多区域信息
  - 支持国际化需求

---

## 标签字段

### TagIDs

- **类型**: `List<String>?`
- **说明**: 群组标签ID集合，关联GroupTag表的ID
- **必填**: 否
- **格式**: 字符串数组
- **示例**: `["tag_001", "tag_002", "tag_003"]`
- **用途**:
  - 群组分类和标记
  - 支持多标签筛选
  - 与群组标签管理系统集成
  - 支持标签搜索功能
- **关联**: 关联 group_tag 集合中的标签记录

---

## API 接口

### 基础接口支持新增字段

以下基础接口现在也支持新增字段的创建和更新：

#### 1. 创建群组 (createGroup)

创建群组时可以在 `groupInfo` 中直接设置新增字段：

**请求参数示例**:

```dart
final groupInfo = GroupInfo(
  groupID: '', // 创建时会自动生成
  groupName: '技术交流群',
  introduction: '这是一个技术交流群',
  faceURL: 'https://example.com/avatar.jpg',
  needVerification: 1,
  lookMemberInfo: 1,
  applyMemberFriend: 1,
  location: '{"type":"Point","coordinates":[116.397128,39.916527]}',
  latitude: 39.916527,
  longitude: 116.397128,
  locationAddress: '北京市东城区天安门广场1号',
  settings: '{"allow_member_invite":true}',
  isPublic: 1,
  maxMemberCount: 500,
  country: 'CN',
  city: '北京',
  district: '东城区',
  administrativeRegion: '{"country":"CN","city":"北京","district":"东城区"}',
  tagIDs: ['tag_001', 'tag_002'],
);

await OpenIM.iMManager.groupManager.createGroup(
  groupInfo: groupInfo,
  memberUserIDs: ['user_789'],
  adminUserIDs: [],
);
```

**说明**:
- 所有新增字段都可以在创建时设置
- `location` 和 `administrativeRegion` 需要是 JSON 格式字符串
- `maxMemberCount` 如果未设置或为 0，会自动设置为 200

#### 2. 更新群组信息 (setGroupInfo)

更新群组信息时可以在 `groupInfo` 中设置新增字段：

**请求参数示例**:

```dart
final groupInfo = GroupInfo(
  groupID: 'group_123456',
  groupName: '更新后的群组名称',
  introduction: '更新后的简介',
  location: '{"type":"Point","coordinates":[116.407526,39.904030]}',
  latitude: 39.904030,
  longitude: 116.407526,
  locationAddress: '北京市西城区',
  settings: '{"allow_member_invite":false}',
  isPublic: 1,
  maxMemberCount: 1000,
  country: 'CN',
  city: '北京',
  district: '西城区',
  administrativeRegion: '{"country":"CN","city":"北京","district":"西城区"}',
  tagIDs: ['tag_003'],
);

await OpenIM.iMManager.groupManager.setGroupInfo(groupInfo);
```

**说明**:
- 只需要传入需要更新的字段，未传入的字段不会更新
- 所有新增字段都支持更新
- `location` 和 `administrativeRegion` 需要是 JSON 格式字符串

#### 3. 获取群组信息 (getGroupsInfo)

获取群组信息时会返回所有新增字段：

**响应示例**:
返回的 `GroupInfo` 对象包含所有新增字段。

### 专用字段管理接口

以下接口专门用于管理新增字段：

#### 1. 设置群组地理位置 (setGroupLocation)

**方法签名**:
```dart
Future<dynamic> setGroupLocation({
  required String groupID,
  required double latitude,
  required double longitude,
  String? locationAddress,
  String? operationID,
})
```

**通信方式**: **HTTP API（短连接）**

**参数说明**:
- `groupID` (String, 必需): 群组ID
- `latitude` (double, 必需): 纬度（-90.0 到 90.0）
- `longitude` (double, 必需): 经度（-180.0 到 180.0）
- `locationAddress` (String, 可选): 地址描述
- `operationID` (String, 可选): 操作ID

**示例**:
```dart
await OpenIM.iMManager.groupManager.setGroupLocation(
  groupID: 'group_123456',
  latitude: 39.916527,
  longitude: 116.397128,
  locationAddress: '北京市东城区天安门广场1号',
);
```

#### 2. 设置群组标签 (setGroupTags)

**方法签名**:
```dart
Future<dynamic> setGroupTags({
  required String groupID,
  required List<String> tagIDs,
  String? operationID,
})
```

**通信方式**: **HTTP API（短连接）**

**参数说明**:
- `groupID` (String, 必需): 群组ID
- `tagIDs` (List<String>, 必需): 标签ID数组（空数组表示清空所有标签）
- `operationID` (String, 可选): 操作ID

**示例**:
```dart
await OpenIM.iMManager.groupManager.setGroupTags(
  groupID: 'group_123456',
  tagIDs: ['tag_001', 'tag_002'],
);
```

#### 3. 设置群组是否公开 (setGroupPublic)

**方法签名**:
```dart
Future<dynamic> setGroupPublic({
  required String groupID,
  required int isPublic,
  String? operationID,
})
```

**通信方式**: **HTTP API（短连接）**

**参数说明**:
- `groupID` (String, 必需): 群组ID
- `isPublic` (int, 必需): 0-不公开，1-公开
- `operationID` (String, 可选): 操作ID

**示例**:
```dart
await OpenIM.iMManager.groupManager.setGroupPublic(
  groupID: 'group_123456',
  isPublic: 1, // 1: 公开, 0: 不公开
);
```

#### 4. 设置群组成员数量限制 (setGroupMaxMemberCount)

**方法签名**:
```dart
Future<dynamic> setGroupMaxMemberCount({
  required String groupID,
  required int maxMemberCount,
  String? operationID,
})
```

**通信方式**: **HTTP API（短连接）**

**参数说明**:
- `groupID` (String, 必需): 群组ID
- `maxMemberCount` (int, 必需): 最大成员数（0表示无限制，最小值为0）
- `operationID` (String, 可选): 操作ID

**示例**:
```dart
await OpenIM.iMManager.groupManager.setGroupMaxMemberCount(
  groupID: 'group_123456',
  maxMemberCount: 500, // 0 表示无限制
);
```

#### 5. 设置群组行政区域 (setGroupAdministrativeRegion)

**方法签名**:
```dart
Future<dynamic> setGroupAdministrativeRegion({
  required String groupID,
  String? country,
  String? city,
  String? district,
  Map<String, dynamic>? administrativeRegion,
  String? operationID,
})
```

**通信方式**: **HTTP API（短连接）**

**参数说明**:
- `groupID` (String, 必需): 群组ID
- `country` (String, 可选): 国家代码（ISO 3166-1 alpha-2）
- `city` (String, 可选): 城市名称
- `district` (String, 可选): 区/县/行政区名称
- `administrativeRegion` (Map<String, dynamic>?, 可选): 完整行政区域信息（JSON对象）
- `operationID` (String, 可选): 操作ID

**注意**: 至少需要提供一个字段

**示例**:
```dart
await OpenIM.iMManager.groupManager.setGroupAdministrativeRegion(
  groupID: 'group_123456',
  country: 'CN',
  city: '北京',
  district: '东城区',
  administrativeRegion: {
    'country': 'CN',
    'country_name': '中国',
    'province': '北京市',
    'city': '北京市',
    'district': '东城区',
    'street': '天安门广场',
    'postal_code': '100006',
    'full_address': '中国北京市东城区天安门广场',
  },
);
```

#### 6. 设置群组设置 (setGroupSettings)

**方法签名**:
```dart
Future<dynamic> setGroupSettings({
  required String groupID,
  required String settings,
  String? operationID,
})
```

**通信方式**: **HTTP API（短连接）**

**参数说明**:
- `groupID` (String, 必需): 群组ID
- `settings` (String, 必需): 群组设置（JSON格式字符串）
- `operationID` (String, 可选): 操作ID

**示例**:
```dart
final settings = jsonEncode({
  'allow_member_invite': true,
  'mute_all': false,
  'welcome_message': '欢迎加入群组',
});

await OpenIM.iMManager.groupManager.setGroupSettings(
  groupID: 'group_123456',
  settings: settings,
);
```

---

## 数据返回示例

### GetGroupsInfo 接口返回示例

```dart
final groups = await OpenIM.iMManager.groupManager.getGroupsInfo(
  groupIDList: ['group_123456'],
);

// groups[0] 包含所有字段：
// {
//   groupID: "group_123456",
//   groupName: "技术交流群",
//   notification: "欢迎加入本群",
//   introduction: "这是一个技术交流群",
//   faceURL: "https://example.com/avatar.jpg",
//   ownerUserID: "user_123456",
//   createTime: 1704067200000,
//   memberCount: 150,
//   ex: "{\"custom_field\":\"value\"}",
//   status: 0,
//   creatorUserID: "user_123456",
//   groupType: 2,
//   needVerification: 1,
//   lookMemberInfo: 1,
//   applyMemberFriend: 1,
//   notificationUpdateTime: 1704153600000,
//   notificationUserID: "user_123456",
//   location: "{\"type\":\"Point\",\"coordinates\":[116.397128,39.916527]}",
//   latitude: 39.916527,
//   longitude: 116.397128,
//   locationAddress: "北京市东城区天安门广场1号",
//   settings: "{\"allow_member_invite\":true}",
//   isPublic: 1,
//   maxMemberCount: 200,
//   country: "CN",
//   city: "北京",
//   district: "东城区",
//   administrativeRegion: "{\"country\":\"CN\",\"city\":\"北京\",\"district\":\"东城区\"}",
//   tagIDs: ["tag_001", "tag_002"]
// }
```

---

## 注意事项

### 地理位置字段

- `Location` 字段使用 GeoJSON 格式，经度在前，纬度在后
- `Latitude` 和 `Longitude` 是冗余字段，便于查询和显示
- 建议同时设置 `Location`、`Latitude`、`Longitude` 和 `LocationAddress`

### 行政区域字段

- `Country` 使用 ISO 3166-1 alpha-2 标准（2位字母代码）
- `AdministrativeRegion` 可以存储完整的层级信息，便于扩展
- 建议同时设置 `Country`、`City`、`District` 和 `AdministrativeRegion`

### 标签字段

- `TagIDs` 关联 `group_tag` 集合中的标签记录
- 标签ID必须是有效的标签记录ID
- 支持多个标签，使用数组存储

### 群组设置

- `Settings` 字段是 JSON 格式字符串，可以存储任意自定义配置
- 建议使用结构化的 JSON 格式，便于解析和扩展

### 默认值

- 新建群组时，`MaxMemberCount` 默认设置为 200
- `IsPublic` 默认值为 0（不公开）

### 权限要求

- 所有设置接口都需要管理员或群主权限

### 索引说明

为了支持高效查询，MongoDB 中创建了以下索引：

- **地理位置索引**: `location` 字段创建了 2dsphere 索引，支持地理检索（$near、$geoWithin 等）
- **行政区域索引**: `country`、`city`、`district` 创建了复合索引，支持按行政区域查询
- **标签索引**: `tag_ids` 字段创建了索引，支持按标签查询群组

---

*文档最后更新时间：2024年*

